# üöÄ Railway Deployment Guide - Step by Step

## Why Railway?
- ‚úÖ Free $5 credit/month
- ‚úÖ Automatic deployments from GitHub
- ‚úÖ Built-in PostgreSQL & Redis
- ‚úÖ Environment variables management
- ‚úÖ Logs & monitoring included
- ‚úÖ Zero configuration needed

---

## üìã Prerequisites

1. GitHub account (you have it)
2. Railway account (free signup)
3. Backend code ready (you have it)

---

## üöÄ Step-by-Step Deployment

### **Step 1: Create Railway Account**

1. Go to [railway.app](https://railway.app)
2. Click "Login with GitHub"
3. Authorize Railway

**Time:** 1 minute

---

### **Step 2: Create New Project**

1. Click "New Project"
2. Select "Deploy from GitHub repo"
3. Choose `Amrikyy-Agent` repository
4. Select `backend` folder as root directory

**Time:** 2 minutes

---

### **Step 3: Add PostgreSQL Database**

1. In your project, click "New"
2. Select "Database"
3. Choose "PostgreSQL"
4. Railway will create and connect it automatically

**Time:** 1 minute

**You'll get:**
```bash
DATABASE_URL=postgresql://postgres:password@host:5432/railway
```

---

### **Step 4: Add Redis**

1. Click "New" again
2. Select "Database"
3. Choose "Redis"
4. Railway will create and connect it automatically

**Time:** 1 minute

**You'll get:**
```bash
REDIS_URL=redis://default:password@host:6379
```

---

### **Step 5: Configure Environment Variables**

In Railway dashboard, go to your backend service ‚Üí Variables:

```bash
# Database (Auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}
REDIS_URL=${{Redis.REDIS_URL}}

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_ANON_KEY=your-anon-key

# APIs
ZAI_API_KEY=your-zai-api-key
KIWI_API_KEY=your-kiwi-api-key
BOOKING_API_KEY=your-booking-api-key

# Auth
JWT_SECRET=your-random-secret-here
SESSION_SECRET=another-random-secret

# Telegram
TELEGRAM_BOT_TOKEN=your-bot-token

# Stripe
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Frontend URL (Update after deployment)
FRONTEND_URL=https://your-app.vercel.app
CORS_ORIGIN=https://your-app.vercel.app

# Node Environment
NODE_ENV=production
PORT=3000
```

**Time:** 5 minutes

---

### **Step 6: Deploy**

1. Railway will automatically deploy on push to main
2. Wait for build to complete (2-3 minutes)
3. Get your backend URL: `https://your-app.up.railway.app`

**Time:** 3 minutes

---

### **Step 7: Update Frontend**

Update your frontend to use the new backend URL:

```typescript
// frontend/src/config/api.ts
const API_BASE_URL = process.env.REACT_APP_API_URL || 
  'https://your-app.up.railway.app';

export default API_BASE_URL;
```

**Time:** 2 minutes

---

### **Step 8: Test Endpoints**

```bash
# Health check
curl https://your-app.up.railway.app/api/health

# Cache stats
curl https://your-app.up.railway.app/api/cache/stats

# Flights search (example)
curl -X POST https://your-app.up.railway.app/api/flights/search \
  -H "Content-Type: application/json" \
  -d '{"from":"CAI","to":"DXB","departureDate":"2024-12-01"}'
```

**Time:** 2 minutes

---

## üîß Railway Configuration Files

### **railway.json** (Optional - for custom config)
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm install && npm run build"
  },
  "deploy": {
    "startCommand": "npm start",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### **Procfile** (Optional)
```
web: npm start
```

---

## üìä Monitoring in Railway

### **Built-in Features:**
1. **Logs**: Real-time logs in dashboard
2. **Metrics**: CPU, Memory, Network usage
3. **Deployments**: History of all deployments
4. **Health Checks**: Automatic health monitoring

### **Access Logs:**
```bash
# In Railway dashboard
1. Go to your service
2. Click "Logs" tab
3. See real-time logs
```

---

## üîí Security Checklist

Before going live:

- [ ] All secrets in environment variables
- [ ] CORS configured for production domain
- [ ] Rate limiting enabled
- [ ] Input validation on all endpoints
- [ ] HTTPS enforced (Railway does this automatically)
- [ ] Database backups enabled
- [ ] Error logging configured

---

## üí∞ Cost Breakdown

### **Free Tier:**
```
Railway Credit: $5/month
Backend Service: ~$3/month
PostgreSQL: $0 (included)
Redis: $0 (included)
Total: $3/month (covered by free credit)
```

### **If You Exceed Free Tier:**
```
Additional usage: $0.000463/GB-hour
Typical cost: $5-10/month
```

---

## üêõ Troubleshooting

### **Build Fails:**
```bash
# Check package.json has start script
"scripts": {
  "start": "node server.js"
}
```

### **Database Connection Fails:**
```bash
# Check DATABASE_URL is set
# Railway auto-injects it, but verify in Variables tab
```

### **Redis Connection Fails:**
```bash
# Check REDIS_URL is set
# Verify Redis service is running
```

### **CORS Errors:**
```bash
# Update CORS_ORIGIN in environment variables
# Restart the service
```

---

## üöÄ Deployment Checklist

- [ ] Railway account created
- [ ] Project created from GitHub
- [ ] PostgreSQL added
- [ ] Redis added
- [ ] Environment variables configured
- [ ] Backend deployed successfully
- [ ] Health check passes
- [ ] Frontend updated with backend URL
- [ ] All endpoints tested
- [ ] Monitoring configured

---

## üìà Next Steps After Deployment

1. **Add Custom Domain** (Optional)
   - Go to Settings ‚Üí Domains
   - Add your custom domain
   - Update DNS records

2. **Enable Backups**
   - PostgreSQL backups are automatic
   - Configure backup retention

3. **Setup Alerts**
   - Configure email alerts for downtime
   - Set up Slack notifications

4. **Monitor Performance**
   - Check logs regularly
   - Monitor resource usage
   - Optimize if needed

---

## üéâ Success!

Your backend is now deployed and running!

**Backend URL:** `https://your-app.up.railway.app`

**Test it:**
```bash
curl https://your-app.up.railway.app/api/health
```

**Expected Response:**
```json
{
  "status": "healthy",
  "timestamp": "2024-10-16T...",
  "uptime": 123.45,
  "memory": {...}
}
```

---

## üìö Resources

- [Railway Docs](https://docs.railway.app)
- [Railway Discord](https://discord.gg/railway)
- [Railway Status](https://status.railway.app)

---

**Total Time:** ~15 minutes  
**Cost:** $0 (free tier)  
**Difficulty:** ‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ (Easy)

---

**Created by:** Ona AI Assistant  
**Date:** October 2024
