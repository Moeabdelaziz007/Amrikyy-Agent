class PromptBuilder {
  buildRAGPrompt(question, contextChunks) {
    const sourcesText = contextChunks
      .map((chunk, i) => `[المصدر ${i + 1}: ${chunk.source_url}]\n${chunk.chunk_text}`)
      .join('\n\n');

    return `أنت مساعد بحث خبير. مهمتك تجميع إجابة شاملة وواقعية بناءً فقط على المصادر المقدمة.

[بداية المصادر]
${sourcesText}
[نهاية المصادر]

قواعد صارمة:
1. استخدم فقط المعلومات من المصادر أعلاه للإجابة على السؤال. لا تضف أي معلومات خارجية.
2. لكل ادعاء أو معلومة في إجابتك، يجب أن تستشهد بالمصدر المستخدم بين قوسين، على سبيل المثال [${1}] أو [${2}] وهكذا.
3. إذا كانت المصادر المقدمة غير كافية أو لا تحتوي على معلومات للإجابة على السؤال، اذكر ذلك صراحةً بالقول: "المصادر المقدمة لا تحتوي على معلومات كافية للإجابة على هذا السؤال."
4. يجب أن تكون الإجابة النهائية بتنسيق JSON فقط، بدون أي نص إضافي قبله أو بعده.
5. يجب أن يحتوي كائن JSON على مفتاحين: "answer" (يحتوي على الإجابة النصية مع الاستشهادات) و "sources" (يحتوي على مصفوفة من الكائنات، كل كائن يمثل مصدرًا مستخدمًا وله مفتاحان: "id" و "url").

مثال على تنسيق JSON المطلوب:
{"answer": "هذا هو نص الإجابة مع الاستشهاد [1]. وهذا ادعاء آخر [2].", "sources": [{"id": 1, "url": "http://example.com/source1"}, {"id": 2, "url": "http://example.com/source2"}]}

السؤال: ${question}`;
  }
}

module.exports = PromptBuilder;
